<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Car Rental</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Admin Panel</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="dashboard">Dashboard</a>
                <a href="#" class="nav-item" data-page="hosts">Hosts</a>
                <a href="#" class="nav-item" data-page="clients">Clients</a>
                <a href="#" class="nav-item" data-page="cars">Cars</a>
                <a href="#" class="nav-item" data-page="feedback">Feedback</a>
                <a href="#" class="nav-item" data-page="notifications">Notifications</a>
                <a href="#" class="nav-item" data-page="payment-methods">Payment Methods</a>
                <a href="#" class="nav-item" data-page="support">Support</a>
                <a href="#" class="nav-item" data-page="admins" id="adminsNavItem" style="display: none;">Admins</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h1 id="pageTitle">Dashboard</h1>
                <div class="profile-dropdown">
                    <button class="profile-button" id="profileButton">
                        <div class="profile-info">
                            <div class="profile-name" id="profileName">Loading...</div>
                            <div class="profile-email" id="profileEmail">Loading...</div>
                        </div>
                        <div class="profile-avatar" id="profileAvatar">A</div>
                    </button>
                    <div class="profile-menu" id="profileMenu">
                        <a href="#" class="profile-menu-item" id="profileLink">My Profile</a>
                        <a href="#" class="profile-menu-item" id="changePasswordLink">Change Password</a>
                        <a href="#" class="profile-menu-item logout" id="logoutLink">Logout</a>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <div class="content" id="contentArea">
                <div id="dashboardPage" class="page-content">
                    <div class="stats-grid" id="statsGrid">
                        <div class="loading">Loading statistics...</div>
                    </div>
                    <div class="graphs-section">
                        <div class="graph-container">
                            <h3>User Distribution</h3>
                            <canvas id="userDistributionChart"></canvas>
                        </div>
                        <div class="graph-container">
                            <h3>Car Verification Status</h3>
                            <canvas id="verificationStatusChart"></canvas>
                        </div>
                    </div>
                    <div class="content-section">
                        <h2>Recent Activity</h2>
                        <div id="recentActivity">
                            <div class="loading">Loading activity...</div>
                        </div>
                    </div>
                </div>

                <div id="hostsPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="margin: 0;">Hosts</h2>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="hostSearch" placeholder="Search by name or email..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 300px;">
                            </div>
                        </div>
                        <div id="hostsContent">
                            <div class="loading">Loading hosts...</div>
                        </div>
                    </div>
                </div>

                <div id="hostDetailPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 24px;">
                            <button class="btn btn-secondary" onclick="backToHostsList()" style="padding: 8px 16px;">← Back</button>
                            <h2 id="hostDetailTitle" style="margin: 0;">Host Details</h2>
                        </div>
                        <div id="hostDetailContent">
                            <div class="loading">Loading host details...</div>
                        </div>
                    </div>
                </div>

                <div id="clientsPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <h2>Clients</h2>
                        <div id="clientsContent">
                            <div class="loading">Loading clients...</div>
                        </div>
                    </div>
                </div>

                <div id="carsPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="margin: 0;">Cars</h2>
                            <div style="display: flex; gap: 10px;">
                                <select id="carStatusFilter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    <option value="">All Status</option>
                                    <option value="awaiting">Awaiting</option>
                                    <option value="verified">Verified</option>
                                    <option value="denied">Denied</option>
                                </select>
                                <input type="text" id="carSearch" placeholder="Search by name or model..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 300px;">
                            </div>
                        </div>
                        <div id="carsContent">
                            <div class="loading">Loading cars...</div>
                        </div>
                    </div>
                </div>

                <div id="carDetailPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 24px;">
                            <button class="btn btn-secondary" onclick="backToCarsList()" style="padding: 8px 16px;">← Back</button>
                            <h2 id="carDetailTitle" style="margin: 0;">Car Details</h2>
                        </div>
                        <div id="carDetailContent">
                            <div class="loading">Loading car details...</div>
                        </div>
                    </div>
                </div>

                <div id="feedbackPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <h2>Feedback</h2>
                        <div id="feedbackContent">
                            <div class="loading">Loading feedback...</div>
                        </div>
                    </div>
                </div>

                <div id="notificationsPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <h2>Notifications Center</h2>
                        <div id="notificationsContent">
                            <!-- Tabs -->
                            <div style="display: flex; gap: 10px; margin-bottom: 24px; border-bottom: 2px solid #e4e6eb;">
                                <button id="hostNotificationTab" onclick="switchNotificationTab('host')" style="padding: 12px 24px; background: none; border: none; border-bottom: 3px solid #3498db; cursor: pointer; font-weight: 600; color: #3498db; font-size: 15px;">Hosts</button>
                                <button id="clientNotificationTab" onclick="switchNotificationTab('client')" style="padding: 12px 24px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 500; color: #65676b; font-size: 15px;">Clients</button>
                            </div>
                            
                            <!-- Host Notifications Form -->
                            <div id="hostNotificationForm" class="notification-form-section">
                                <h3>Send Notification to Hosts</h3>
                                <form id="notificationForm" onsubmit="sendNotification(event)">
                                    <div class="form-group">
                                        <label for="notificationTitle">Title</label>
                                        <input type="text" id="notificationTitle" name="title" required maxlength="255" placeholder="Enter notification title">
                                    </div>
                                    <div class="form-group">
                                        <label for="notificationMessage">Message</label>
                                        <textarea id="notificationMessage" name="message" required maxlength="1000" rows="5" placeholder="Enter notification message"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="notificationType">Type</label>
                                        <select id="notificationType" name="type">
                                            <option value="info">Info</option>
                                            <option value="success">Success</option>
                                            <option value="warning">Warning</option>
                                            <option value="error">Error</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="radio" name="recipientType" value="all" checked onchange="toggleHostSelection()"> Send to All Active Hosts
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="radio" name="recipientType" value="specific" onchange="toggleHostSelection()"> Send to Specific Host
                                        </label>
                                    </div>
                                    <div class="form-group" id="hostSelectionGroup" style="display: none;">
                                        <label for="notificationHostSelect">Select Host</label>
                                        <select id="notificationHostSelect" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 100%;">
                                            <option value="">Loading hosts...</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-primary" id="sendNotificationBtn">Send Notification</button>
                                    </div>
                                </form>
                                <div id="notificationResult" style="margin-top: 20px;"></div>
                            </div>
                            
                            <!-- Client Notifications Form -->
                            <div id="clientNotificationForm" class="notification-form-section" style="display: none;">
                                <h3>Send Notification to Clients</h3>
                                <form id="clientNotificationForm" onsubmit="sendClientNotification(event)">
                                    <div class="form-group">
                                        <label for="clientNotificationTitle">Title</label>
                                        <input type="text" id="clientNotificationTitle" name="title" required maxlength="255" placeholder="Enter notification title">
                                    </div>
                                    <div class="form-group">
                                        <label for="clientNotificationMessage">Message</label>
                                        <textarea id="clientNotificationMessage" name="message" required maxlength="1000" rows="5" placeholder="Enter notification message"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="clientNotificationType">Type</label>
                                        <select id="clientNotificationType" name="type">
                                            <option value="info">Info</option>
                                            <option value="success">Success</option>
                                            <option value="warning">Warning</option>
                                            <option value="error">Error</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="radio" name="clientRecipientType" value="all" checked onchange="toggleClientSelection()"> Send to All Active Clients
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="radio" name="clientRecipientType" value="specific" onchange="toggleClientSelection()"> Send to Specific Client
                                        </label>
                                    </div>
                                    <div class="form-group" id="clientSelectionGroup" style="display: none;">
                                        <label for="notificationClientSelect">Select Client</label>
                                        <select id="notificationClientSelect" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 100%;">
                                            <option value="">Loading clients...</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-primary" id="sendClientNotificationBtn">Send Notification</button>
                                    </div>
                                </form>
                                <div id="clientNotificationResult" style="margin-top: 20px;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="adminsPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="margin: 0;">Admins</h2>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-primary" onclick="showCreateAdminForm()">Create Admin</button>
                                <select id="adminRoleFilter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    <option value="">All Roles</option>
                                    <option value="super_admin">Super Admin</option>
                                    <option value="admin">Admin</option>
                                    <option value="moderator">Moderator</option>
                                </select>
                                <select id="adminStatusFilter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    <option value="">All Status</option>
                                    <option value="true">Active</option>
                                    <option value="false">Inactive</option>
                                </select>
                                <input type="text" id="adminSearch" placeholder="Search by name or email..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 300px;">
                            </div>
                        </div>
                        <div id="adminsContent">
                            <div class="loading">Loading admins...</div>
                        </div>
                    </div>
                </div>

                <div id="adminDetailPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 24px;">
                            <button class="btn btn-secondary" onclick="backToAdminsList()" style="padding: 8px 16px;">← Back</button>
                            <h2 id="adminDetailTitle" style="margin: 0;">Admin Details</h2>
                        </div>
                        <div id="adminDetailContent">
                            <div class="loading">Loading admin details...</div>
                        </div>
                    </div>
                </div>

                <div id="myProfilePage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <h2>My Profile</h2>
                        <div id="myProfileContent">
                            <div class="loading">Loading profile...</div>
                        </div>
                    </div>
                </div>

                <div id="paymentMethodsPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="margin: 0;">Payment Methods</h2>
                            <div style="display: flex; gap: 10px;">
                                <select id="paymentMethodTypeFilter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    <option value="">All Types</option>
                                    <option value="mpesa">M-Pesa</option>
                                    <option value="visa">Visa</option>
                                    <option value="mastercard">Mastercard</option>
                                </select>
                                <input type="number" id="paymentMethodHostFilter" placeholder="Host ID..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 150px;">
                                <input type="text" id="paymentMethodSearch" placeholder="Search by name or host..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 300px;">
                            </div>
                        </div>
                        <div id="paymentMethodsContent">
                            <div class="loading">Loading payment methods...</div>
                        </div>
                    </div>
                </div>

                <div id="paymentMethodDetailPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 24px;">
                            <button class="btn btn-secondary" onclick="backToPaymentMethodsList()" style="padding: 8px 16px;">← Back</button>
                            <h2 id="paymentMethodDetailTitle" style="margin: 0;">Payment Method Details</h2>
                        </div>
                        <div id="paymentMethodDetailContent">
                            <div class="loading">Loading payment method details...</div>
                        </div>
                    </div>
                </div>

                <div id="supportPage" class="page-content" style="display: none;">
                    <div class="content-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="margin: 0;">Support Conversations</h2>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span id="unreadCount" style="font-weight: 600; color: #e74c3c; font-size: 14px;"></span>
                                <select id="supportStatusFilter" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    <option value="">All Status</option>
                                    <option value="open">Open</option>
                                    <option value="closed">Closed</option>
                                </select>
                                <input type="number" id="supportHostIdFilter" placeholder="Host ID..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 120px;">
                                <input type="text" id="supportSearch" placeholder="Search by host name or email..." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 300px;">
                            </div>
                        </div>
                        <div id="supportContent">
                            <div class="loading">Loading conversations...</div>
                        </div>
                        <div id="supportPagination" style="margin-top: 20px; display: flex; justify-content: center; gap: 10px; align-items: center;"></div>
                    </div>
                </div>

                <div id="supportDetailPage" class="page-content" style="display: none; padding: 0;">
                    <div style="display: flex; flex-direction: column; height: calc(100vh - 100px); background: #f0f2f5;">
                        <!-- Header -->
                        <div id="supportChatHeader" style="background: #fff; padding: 12px 20px; border-bottom: 1px solid #e4e6eb; display: flex; align-items: center; gap: 12px;">
                            <button onclick="backToSupportList()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #65676b; padding: 4px 8px;">←</button>
                            <div id="supportConversationInfo" style="flex: 1; display: flex; align-items: center; gap: 12px;">
                                <div class="loading">Loading...</div>
                            </div>
                            <div id="supportChatActions" style="display: flex; gap: 8px;">
                                <button id="closeConversationBtn" onclick="closeSupportConversation()" style="display: none; background: none; border: 1px solid #ddd; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; color: #65676b;">Close</button>
                                <button id="reopenConversationBtn" onclick="reopenSupportConversation()" style="display: none; background: none; border: 1px solid #ddd; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; color: #65676b;">Reopen</button>
                            </div>
                        </div>
                        
                        <!-- Messages Area -->
                        <div id="supportMessages" style="flex: 1; overflow-y: auto; padding: 20px; background: #f0f2f5;">
                            <div class="loading">Loading messages...</div>
                        </div>
                        
                        <!-- Reply Form -->
                        <div id="supportReplyForm" style="background: #fff; padding: 12px 20px; border-top: 1px solid #e4e6eb;">
                            <form id="supportReplyFormElement" onsubmit="sendSupportReply(event)" style="display: flex; gap: 10px; align-items: flex-end;">
                                <textarea id="supportReplyMessage" placeholder="Type a message..." required style="flex: 1; padding: 10px 14px; border: 1px solid #e4e6eb; border-radius: 20px; font-size: 15px; min-height: 40px; max-height: 120px; resize: none; font-family: inherit; outline: none;" rows="1"></textarea>
                                <button type="submit" style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-size: 14px; font-weight: 500;">Send</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Create/Edit Admin Modal -->
    <div id="adminModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="adminModalTitle">Create Admin</h2>
                <button class="modal-close" onclick="closeAdminModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="adminForm" onsubmit="saveAdmin(event)">
                    <input type="hidden" id="adminFormId" value="">
                    <div class="form-group">
                        <label for="adminFullName">Full Name *</label>
                        <input type="text" id="adminFullName" required maxlength="255" placeholder="Enter full name">
                    </div>
                    <div class="form-group">
                        <label for="adminEmail">Email *</label>
                        <input type="email" id="adminEmail" required placeholder="Enter email address">
                    </div>
                    <div id="adminPasswordFields">
                        <div class="form-group">
                            <label for="adminPassword">Password *</label>
                            <input type="password" id="adminPassword" minlength="8" placeholder="Enter password (min 8 characters)">
                        </div>
                        <div class="form-group">
                            <label for="adminPasswordConfirm">Confirm Password *</label>
                            <input type="password" id="adminPasswordConfirm" minlength="8" placeholder="Confirm password">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="adminRole">Role *</label>
                        <select id="adminRole" required>
                            <option value="admin">Admin</option>
                            <option value="moderator">Moderator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="adminIsActive" checked> Active Account
                        </label>
                    </div>
                    <div id="adminFormError" style="color: #d32f2f; margin-bottom: 15px;"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeAdminModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="saveAdminBtn">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="passwordModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 id="passwordModalTitle">Change Password</h2>
                <button class="modal-close" onclick="closePasswordModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="passwordForm" onsubmit="savePassword(event)">
                    <input type="hidden" id="passwordFormType" value="own">
                    <input type="hidden" id="passwordFormAdminId" value="">
                    <div id="currentPasswordField" class="form-group">
                        <label for="currentPassword">Current Password *</label>
                        <input type="password" id="currentPassword" required placeholder="Enter current password">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password *</label>
                        <input type="password" id="newPassword" required minlength="8" placeholder="Enter new password (min 8 characters)">
                    </div>
                    <div class="form-group">
                        <label for="newPasswordConfirm">Confirm New Password *</label>
                        <input type="password" id="newPasswordConfirm" required minlength="8" placeholder="Confirm new password">
                    </div>
                    <div id="passwordFormError" style="color: #d32f2f; margin-bottom: 15px;"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closePasswordModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="savePasswordBtn">Change Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="api.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>
